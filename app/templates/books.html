{% extends "base.html" %}
{% block content %}
  <section class="hero">
    <div class="card">
      <h2>
        Books
        {% if author_name %} by {{ author_name }}{% endif %}
        {% if tag_name %} tagged {{ tag_name }}{% endif %}
      </h2>
      {% if author_name or tag_name %}
        <p><a href="/books">View all books</a></p>
      {% endif %}
      <p class="note">Select a title to review files and metadata.</p>
      <form class="tag-form" method="get" action="/books">
        <input class="input" type="text" name="q" placeholder="Search titles or authors" value="{{ query }}" />
        {% if author_id %}
          <input type="hidden" name="author_id" value="{{ author_id }}" />
        {% endif %}
        <button class="btn btn-outline btn-small" type="submit">Search</button>
        {% if query or tag_id %}
          <a class="btn btn-small" href="/books{% if author_id %}?author_id={{ author_id }}{% endif %}">Clear</a>
        {% endif %}
      </form>
    </div>
  </section>

  <section class="section">
    <div class="card">
      <h3>Library Titles</h3>
      {% if books %}
        <div class="list">
          {% for book in books %}
            <div class="card">
              <div>
                <a href="/books/{{ book['id'] }}">{{ book['title'] }}</a><br />
                <small>{{ book['author'] }}</small>
              </div>
              <p class="note">{{ book['description'] or "No description yet." }}</p>
              {% if book['namespace_tags'] %}
                <div class="pill-row">
                  {% for tag in book['namespace_tags'] %}
                    <span class="tag-pill">{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
              {% if book['topics'] %}
                <div class="pill-row">
                  {% for topic in book['topics'] %}
                    <span class="tag-pill tag-pill-proposed">topic:{{ topic }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="note">No books found yet. Run a scan.</p>
      {% endif %}
    </div>
  </section>
{% endblock %}
