{% extends "base.html" %}
{% block content %}
  <section class="hero">
    <div class="card">
      <h2>
        Books
        {% if author_name %} by {{ author_name }}{% endif %}
        {% if tag_name %} tagged {{ tag_name }}{% endif %}
      </h2>
      {% if author_name or tag_name %}
        <p><a href="/books">View all books</a></p>
      {% endif %}
      <p class="note">Select a title to review files and metadata.</p>
      <form class="tag-form" method="get" action="/books">
        <input class="input" type="text" name="q" placeholder="Search titles or authors" value="{{ query }}" />
        {% if author_id %}
          <input type="hidden" name="author_id" value="{{ author_id }}" />
        {% endif %}
        <button class="btn btn-outline btn-small" type="submit">Search</button>
        {% if query or tag_id %}
          <a class="btn btn-small" href="/books{% if author_id %}?author_id={{ author_id }}{% endif %}">Clear</a>
        {% endif %}
      </form>
    </div>
  </section>

  <section class="section">
    <div class="card">
      <h3>Library Titles</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          {% for book in books %}
            {% set desc = book['description'] or "" %}
            <tr>
              <td>
                <a class="table-link" href="/books/{{ book['id'] }}">{{ book['title'] }}</a>
              </td>
              <td>
                {{ book['author'] or "Unknown author" }}
              </td>
              <td>
                {% if desc %}
                  {{ desc[:160] }}{% if desc|length > 160 %}...{% endif %}
                {% else %}
                  <span class="note">No description yet.</span>
                {% endif %}
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="3" class="note">No books found yet. Run a scan.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}
